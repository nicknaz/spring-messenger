
CREATE TABLE IF NOT EXISTS users(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email varchar(256) NOT NULL UNIQUE,
    password varchar(256) NOT NULL,
    username varchar(100));

CREATE TABLE IF NOT EXIST refresh_tokens(
    user_id BIGINT REFERENCES users(id) UNIQUE ON DELETE CASCADE,
    refresh_token varchar(600) NOT NULL UNIQUE,
    primary key (user_id);

CREATE TABLE IF NOT EXISTS dialogs(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    idFirstUser REFERENCES users(id) NOT NULL ON DELETE CASCADE,
    idSecondUser REFERENCES users(id) NOT NULL ON DELETE CASCADE;

CREATE TABLE IF NOT EXISTS messages(
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    idDialog REFERENCES dialogs(id) NOT NULL ON DELETE CASCADE,
    idSender REFERENCES users(id) NOT NULL ON DELETE CASCADE,
    message text NOT NULL,
    dateTime timestamp NOT NULL;
)